<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‡∏õ‡∏±‡∏î‡∏õ‡∏¥‡πâ‡∏ß | PadPiw</title>
    <link rel="stylesheet" href="css/bootstrap.min.css">
    <link href="https://fonts.googleapis.com/css?family=Mali&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Mali', cursive;
            touch-action: manipulation;
        }

        .color-brown {
            background: rgb(75, 31, 51);
        }

        .color-yellow {
            background: rgb(255, 190, 91);
        }

        .title {
            font-size: 5.8em;
            text-shadow: 3px 2px white;
        }

        .show {
            display: flex;
        }

        .hide {
            display: none;
        }

        .emoji {
            font-size: 2.4em;
            letter-spacing: 2px;
            border-style: solid;
            border-color: coral;
            border-radius: 25px;
        }

        .score {
            font-size: 1.7em;
        }

        .touchpad {
            height: 28vh;
            border-radius: 5px;
        }

        .touchpad1 {
            border-width: 1px;
            border-style: solid;
            border-color: white;
            border-radius: 5px;
            height: 27vh;
        }

        .correct {
            font-size: 2.4em;
            letter-spacing: 2px;
            border-style: solid;
            border-color: greenyellow;
            border-radius: 25px;
        }

        .wrong {
            font-size: 2.4em;
            letter-spacing: 2px;
            border-style: solid;
            border-color: red;
            border-radius: 25px;
        }
    </style>
</head>

<body class="color-yellow fixed-top">
    <!-- navbar -->
    <nav class="navbar navbar-light color-brown">
        <a class="navbar-brand text-white" href=".">
            ‡∏õ‡∏±‡∏î‡∏õ‡∏¥‡πâ‡∏ß ü§üüèª
        </a>
    </nav>

    <!-- container -->
    <div class="container-fluid" style="height: 80vh">
        <!-- mainDisplay -->
        <div class="row h-100 show" id="mainScreen">
            <div class="col-12 my-auto">
                <p class="mb-4 text-center title">‡∏õ‡∏±‡∏î‡∏õ‡∏¥‡πâ‡∏ß</p>
                <div class="d-block text-center">
                    <button class="btn btn-lg btn-danger mb-4" onclick="hideScreen('mainScreen')">‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÄ‡∏•‡πà‡∏ô</button>
                </div>
                <div class="d-block text-center">
                    <button class="btn btn-lg btn-primary" data-toggle="modal" data-target="#howTo" data-keyboard="true"
                        data-focus="true">‡∏ß‡∏¥‡∏ò‡∏µ‡∏Å‡∏≤‡∏£‡πÄ‡∏•‡πà‡∏ô</button>
                </div>

                <!-- modal -->
                <div class="modal fade" id="howTo" tabindex="-1">
                    <div class="modal-dialog modal-dialog-centered">
                        <div class="modal-content">
                            <div class="modal-header">
                                <h5>‡∏ß‡∏¥‡∏ò‡∏µ‡∏Å‡∏≤‡∏£‡πÄ‡∏•‡πà‡∏ô üïπ</h5>
                            </div>
                            <div class="modal-body text-center">
                                <p>1. ‡∏ö‡∏•‡∏≤‡∏ö‡∏•‡∏≤‡∏ö‡∏•‡∏≤‡∏ö‡∏•‡∏≤</p>
                                <p>2. ‡∏ö‡∏•‡∏≤‡∏ö‡∏•‡∏≤‡∏ö‡∏•‡∏≤‡∏ö‡∏•‡∏≤</p>
                                <p>3. ‡∏ö‡∏•‡∏≤‡∏ö‡∏•‡∏≤‡∏ö‡∏•‡∏≤‡∏ö‡∏•‡∏≤</p>
                                <p>4. ‡∏ö‡∏•‡∏≤‡∏ö‡∏•‡∏≤‡∏ö‡∏•‡∏≤‡∏ö‡∏•‡∏≤</p>
                                <p>5. ‡∏ö‡∏•‡∏≤‡∏ö‡∏•‡∏≤‡∏ö‡∏•‡∏≤‡∏ö‡∏•‡∏≤</p>
                                <p>6. ‡∏ö‡∏•‡∏≤‡∏ö‡∏•‡∏≤‡∏ö‡∏•‡∏≤‡∏ö‡∏•‡∏≤</p>
                            </div>
                            <div class="modal-footer">
                                <button class="btn btn-danger" data-dismiss="modal">‡∏õ‡∏¥‡∏î</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <!-- startDisplay -->
        <div class="row h-100 hide" id="startScreen">
            <div class="col-12 my-auto">
                <div class="row">
                    <div class="col-12 text-center my-3">
                        <p class="score d-inline">‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô : </p>
                        <p class="score d-inline" id="point">0</p>
                    </div>
                </div>
                <div class="row">
                    <div class="col-12 text-center">
                        <p id="emoji_output" class="emoji mb-2">üö´</p>
                    </div>
                </div>
                <div class="row">
                    <div class="col-12 text-center">
                        <p id="emoji_input" class="emoji mb-2">üö´</p>
                    </div>
                </div>
                <div class="row p-2">
                    <div class="col-12 bg-dark touchpad p-1" id="touchZone">
                        <div class="col-12 bg-dark touchpad1">
                            <p class="mb-0 text-white d-inline">‡∏£‡∏≠‡∏ö : </p>
                            <p class="mb-0 text-white d-inline" id="rounds">0</p>
                        </div>
                    </div>
                </div>
                <div class="row">
                    <div class="col-12 text-center">
                        <button class="btn btn-danger" onclick="hideScreen('startScreen')">‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡πÄ‡∏Å‡∏°</button>
                    </div>
                </div>
                <!-- script -->
                <script>
                    // display function
                    function showScreen(id) {
                        document.getElementById(id).classList.remove("hide")
                        document.getElementById(id).classList.add("show")
                    }

                    function hideScreen(id) {
                        document.getElementById(id).classList.remove("show")
                        document.getElementById(id).classList.add("hide")
                        if (id == 'mainScreen') {
                            showScreen('startScreen')
                            emoji_start()
                        } else if (id == 'startScreen') {
                            showScreen('mainScreen')
                            set_score("reset")
                            set_round("reset")
                        }
                    }

                    // main function
                    // direction = ['üëÜüèª', 'üëáüèª', 'üëàüèª', 'üëâüèª'] // direction emoji
                    let direction = ["U", "D", "L", "R"] // direction key

                    let score = 0 // game score
                    let position = 0 // position of key
                    let text = "" // display key as emoji
                    let key = "" // store direction key
                    let user_input = " " // emoji direction input
                    let wrong = 0 // check direction wrong
                    let digit = 0 // display digit 
                    let old_digit = 0 // old digit
                    let round = 1 // play round

                    let xDown = null
                    let yDown = null

                    touchZone.addEventListener("touchstart", handleTouchStart, false)
                    touchZone.addEventListener("touchmove", handleTouchMove, false)

                    function getTouches(evt) {
                        return (
                            evt.touches || evt.originalEvent.touches
                        )
                    }

                    function handleTouchStart(evt) {
                        const firstTouch = getTouches(evt)[0]
                        xDown = firstTouch.clientX
                        yDown = firstTouch.clientY
                    }

                    function handleTouchMove(evt) {
                        if (!xDown || !yDown) {
                            return
                        }

                        var xUp = getTouches(evt)[0].clientX
                        var yUp = getTouches(evt)[0].clientY

                        var xDiff = xDown - xUp
                        var yDiff = yDown - yUp

                        if (Math.abs(xDiff) > Math.abs(yDiff)) {
                            /*most significant*/
                            if (xDiff > 0) {
                                /* left swipe */
                                if (key.slice(position, position + 1) == "L") {
                                    user_input += "üëàüèª"
                                    emoji_input.innerText = user_input
                                    position += 1
                                } else {
                                    wrong = 1
                                }
                            } else {
                                /* right swipe */
                                if (key.slice(position, position + 1) == "R") {
                                    user_input += "üëâüèª"
                                    emoji_input.innerText = user_input
                                    position += 1
                                } else {
                                    wrong = 1
                                }
                            }
                        } else {
                            if (yDiff > 0) {
                                /* up swipe */
                                if (key.slice(position, position + 1) == "U") {
                                    user_input += "üëÜüèª"
                                    emoji_input.innerText = user_input
                                    position += 1
                                } else {
                                    wrong = 1
                                }
                            } else {
                                /* down swipe */
                                if (key.slice(position, position + 1) == "D") {
                                    user_input += "üëáüèª"
                                    emoji_input.innerText = user_input
                                    position += 1
                                } else {
                                    wrong = 1
                                }
                            }
                        }

                        if (wrong) {
                            statusWrong()
                            reset_input()
                            // reset wrong check
                            wrong = 0
                            //  minus score
                            set_score("minus")
                            // add round
                            set_round("add")
                        }

                        // all match
                        if (position == digit) {
                            statusCorrect()
                            emoji_start()
                            // plus score
                            set_score("plus")
                            // add round
                            set_round("add")
                        }

                        /* reset values */
                        xDown = null
                        yDown = null
                    }

                    function emoji_start() {
                        text = ""
                        key = ""
                        reset_input()
                        old_digit = digit
                        digit = randomInt(4, 7)
                        rounds.innerText = `${round}`

                        for (let i = 0; i < digit; i++) {
                            let random = Math.floor(Math.random() * 4)
                            key += direction[random]
                            if (direction[random] == "U") {
                                text += "üëÜüèª"
                            } else if (direction[random] == "D") {
                                text += "üëáüèª"
                            } else if (direction[random] == "L") {
                                text += "üëàüèª"
                            } else if (direction[random] == "R") {
                                text += "üëâüèª"
                            }
                        }

                        emoji_output.innerText = text
                    }

                    function reset_input() {
                        position = 0
                        user_input = ""
                        emoji_input.innerText = "‚Äè‚Äè‚Äé ‚Äé"
                    }

                    function set_score(type) {
                        if (type == "reset") {
                            score = 0
                        } else if (type == "plus") {
                            score += old_digit
                        } else if (type == "minus") {
                            score -= (digit)
                        }
                        point.innerText = `${score}`
                    }

                    function randomInt(min, max) {
                        min = Math.ceil(min);
                        max = Math.floor(max);
                        return Math.floor(Math.random() * (max - min + 1)) + min;
                    }

                    function set_round(type) {
                        if (type == "add") {
                            round += 1
                            rounds.innerText = `${round}`
                        } else if (type == "reset") {
                            round = 1
                            rounds.innerText = `${round}`
                        }
                    }

                    function statusCorrect() {
                        emoji_input.classList.remove("emoji")
                        emoji_input.classList.add("correct")
                        setTimeout(() => {
                            emoji_input.classList.remove("correct")
                            emoji_input.classList.add("emoji")
                        }, 300)
                    }

                    function statusWrong() {
                        emoji_input.classList.remove("emoji")
                        emoji_input.classList.add("wrong")
                        setTimeout(() => {
                            emoji_input.classList.remove("wrong")
                            emoji_input.classList.add("emoji")
                        }, 300)
                    }
                </script>

                <script src="js/jquery-3.4.1.min.js"></script>
                <script src="js/popper.min.js"></script>
                <script src="js/bootstrap.min.js"></script>
</body>

</html>